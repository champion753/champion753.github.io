---
title: 'การดึงข้อมูลพยากรณ์อากาศและแสดงผลบนแผนที่ (WeatherForecast7Days)'
date: 2025-12-12
permalink: /posts/2014/08/WeatherForecast7Days/
tags:
  - Weather forcast
  - Thailand
  - Coding
---

1. วัตถุประสงค์
เพื่อพัฒนาระบบอัตโนมัติในการดึงข้อมูลพยากรณ์อากาศล่วงหน้าจากกรมอุตุนิยมวิทยา (TMD API) และนำเสนอข้อมูลในรูปแบบแผนที่ประเทศไทย (Interactive Map) ที่สามารถระบุความเข้มข้นของอุณหภูมิในแต่ละจังหวัดด้วยเฉดสีได้ เพื่อให้ง่ายต่อการวิเคราะห์สภาพอากาศในภาพรวม
2. เครื่องมือและไลบรารีที่ใช้ (Tools & Libraries)
•	Python: ภาษาหลักในการพัฒนา
•	Requests: ใช้เชื่อมต่อและดึงข้อมูลจาก API ของกรมอุตุฯ
•	Pandas: ใช้จัดระเบียบข้อมูลให้อยู่ในรูปแบบตาราง (DataFrame) เพื่อการคำนวณที่ง่าย
•	Folium & Geopandas: ใช้สร้างแผนที่และจัดการข้อมูลทางภูมิศาสตร์ (Shapefile/GeoJSON)
•	XML ElementTree: ใช้ถอดรหัสข้อมูลที่ได้รับจาก API ซึ่งอยู่ในรูปแบบ XML
3. ขั้นตอนการทำงานของโปรแกรม (Workflow)
ขั้นตอนที่ 1: การเชื่อมต่อและดึงข้อมูล (Data Fetching) โปรแกรมทำการส่งคำขอ (Request) ไปยัง API ของกรมอุตุนิยมวิทยา (API: WeatherForecast7Days) โดยใช้ UID และ UKEY ที่ได้รับจากการลงทะเบียน ข้อมูลที่ได้รับกลับมาจะเป็นไฟล์รูปแบบ XML ที่ประกอบด้วยพยากรณ์อากาศรายจังหวัด
ขั้นตอนที่ 2: การทำความสะอาดและเตรียมข้อมูล (Data Cleaning)
•	แปลงข้อมูล XML ให้เป็นรายการ (List) ที่อ่านง่าย
•	ดึงเฉพาะข้อมูลที่สนใจ ได้แก่ ชื่อจังหวัด, อุณหภูมิสูงสุด (Max Temp), อุณหภูมิต่ำสุด, ความเร็วลม และคำอธิบายสภาพอากาศ
•	การจัดการชื่อจังหวัด: เนื่องจากชื่อจังหวัดในไฟล์แผนที่ (GeoJSON) และข้อมูลจากกรมอุตุฯ สะกดภาษาอังกฤษไม่ตรงกันบางส่วน โปรแกรมจึงมีฟังก์ชัน Mapping เพื่อจับคู่ชื่อจังหวัดให้ตรงกัน เพื่อให้ข้อมูลแสดงผลครบทุกพื้นที่
ขั้นตอนที่ 3: การสร้างแผนที่ (Mapping & Visualization)
•	นำเข้าข้อมูลแผนที่ประเทศไทย (GeoJSON) และรวมตารางข้อมูลสภาพอากาศเข้ากับพิกัดแผนที่
•	กำหนดเฉดสี (Color Scale): สร้างแถบสีแบบ Linear โดยไล่ระดับจากสีน้ำเงิน (เย็น) ไปยังสีแดง (ร้อน) ตามค่าอุณหภูมิสูงสุดของแต่ละจังหวัด
•	เทคนิค Inverse Masking: สร้าง "หน้ากากสีขาว" บังพื้นที่ส่วนอื่นๆ ของโลกที่ไม่ใช่ประเทศไทย เพื่อให้แผนที่ดูสะอาดตาและโฟกัสเฉพาะพื้นที่ประเทศไทยเท่านั้น
4. ผลลัพธ์ที่ได้ (Output)
เมื่อรันโปรแกรมสำเร็จ จะได้รับไฟล์ HTML (thailand_weather_cropped.html) ซึ่งเป็นแผนที่ประเทศไทยที่สามารถซูมเข้า-ออกได้ เมื่อเอาเมาส์ไปชี้ที่แต่ละจังหวัด จะแสดงรายละเอียดพยากรณ์อากาศ วันที่ และอุณหภูมิอย่างชัดเจน
